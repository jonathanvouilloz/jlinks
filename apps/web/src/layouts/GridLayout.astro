---
import BaseLayout from './BaseLayout.astro';
import ProfileHeader from '../components/ProfileHeader.astro';
import Icon from '../components/Icon.astro';
import VCardButton from '../components/VCardButton.astro';
import Footer from '../components/Footer.astro';
import { SOCIAL_PRESETS } from '@jlinks/shared';
import type { SocialPresetKey } from '@jlinks/shared';

interface Props {
  client: any;
  links: any[];
}

const { client, links } = Astro.props;
---

<BaseLayout
  title={client.meta_title || client.name}
  description={client.meta_description || client.bio}
  fontTitle={client.font_title}
  fontText={client.font_text}
  backgroundColor={client.background_value}
  textColor={client.secondary_color}
>
  <main class="container">
    <ProfileHeader
      name={client.name}
      bio={client.bio}
      imageUrl={client.profile_image_url}
      logoUrl={client.logo_url}
    />

    <div class="links-grid">
      {
        links.map((link) => {
          const preset = link.social_preset
            ? SOCIAL_PRESETS[link.social_preset as SocialPresetKey]
            : null;
          const bgColor = preset?.bgColor || link.custom_bg_color || client.primary_color;
          const textColor = preset?.textColor || link.custom_text_color || '#FFFFFF';
          const iconName = link.icon || preset?.icon || 'link';

          return (
            <a
              href={link.url}
              class="link-grid-item"
              style={`background: ${bgColor}; color: ${textColor};`}
              target="_blank"
              rel="noopener noreferrer"
              title={link.title}
            >
              <span class="link-grid-icon">
                <Icon name={iconName} size={28} />
              </span>
              <span class="link-grid-title">{link.title}</span>
            </a>
          );
        })
      }
    </div>

    {client.vcard_enabled && <VCardButton slug={client.slug} />}

    <Footer showBranding={client.plan !== 'pro'} />
  </main>
</BaseLayout>
