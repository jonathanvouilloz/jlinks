---
import Icon from './Icon.astro';
import { SOCIAL_PRESETS } from '@jlinks/shared';
import type { SocialPresetKey, ButtonStyle } from '@jlinks/shared';

interface Props {
  title: string;
  url: string;
  icon?: string | null;
  socialPreset?: SocialPresetKey | null;
  bgColor?: string;
  textColor?: string;
  opacity?: number;
  buttonStyle?: ButtonStyle;
}

const { title, url, icon, socialPreset, bgColor = '#000000', textColor = '#FFFFFF', opacity = 100, buttonStyle = 'rounded' } = Astro.props;

// Get preset styling if using a social preset
const preset = socialPreset ? SOCIAL_PRESETS[socialPreset as SocialPresetKey] : null;
const finalBgColor = preset?.bgColor || bgColor;
const finalTextColor = preset?.textColor || textColor;
const iconName = icon || preset?.icon || 'link';

// Convert hex to rgba with opacity
function hexToRgba(hex: string, alpha: number): string {
  if (!hex || !hex.startsWith('#')) return hex;
  const r = parseInt(hex.slice(1, 3), 16);
  const g = parseInt(hex.slice(3, 5), 16);
  const b = parseInt(hex.slice(5, 7), 16);
  return `rgba(${r}, ${g}, ${b}, ${alpha / 100})`;
}

// Get border-radius based on button style
function getButtonRadius(style: ButtonStyle): string {
  switch (style) {
    case 'pill': return '50px';
    case 'square': return '4px';
    case 'soft': return '16px';
    case 'outline': return '8px';
    case 'rounded':
    default: return '8px';
  }
}

const isOutline = buttonStyle === 'outline';
const buttonRadius = getButtonRadius(buttonStyle);

// Apply opacity only to solid hex colors
const bgWithOpacity = opacity < 100 && finalBgColor.startsWith('#')
  ? hexToRgba(finalBgColor, opacity)
  : finalBgColor;

// Build style string based on button style
const styleString = isOutline
  ? `background: transparent; border: 2px solid ${finalBgColor}; color: ${finalBgColor}; border-radius: ${buttonRadius};`
  : `background: ${bgWithOpacity}; color: ${finalTextColor}; border-radius: ${buttonRadius};`;
---

<a
  href={url}
  class="link-button"
  target="_blank"
  rel="noopener noreferrer"
  style={styleString}
>
  <Icon name={iconName} size={20} />
  <span>{title}</span>
</a>

<style>
  .link-button {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    padding: 1rem 1.5rem;
    font-size: 1rem;
    font-weight: 500;
    transition:
      transform 0.15s ease,
      box-shadow 0.15s ease;
    text-align: center;
  }

  .link-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  .link-button:active {
    transform: translateY(0);
  }
</style>
